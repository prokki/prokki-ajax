/*
 Prokki Ajax 0.0.2
 Available under the MIT license.
 See https://github.com/prokki/prokki-ajax/ for more information.
*/
var ProkkiAjax=function(d){this._options={};this.$_overlay=null;this._startTime=new Date;this._xhr=null;this._initializeOptions=function(a){this._options=$.extend({},ProkkiAjax.DEFAULTS,a||{})};this._createOverlay=function(){var a=this._options.overlay.split(" "),a=a[a.length-1],b="div",c="";-1<a.search(/^[^#\.]+/g)&&(b=a.match(/^[^#\.]+/g));b=$(document.createElement(b));if(-1<a.search(/#[^#\.\s]+/g)){c=a.match(/#[^#\.\s]+/g).map(function(a){return a.substring(1)});if(1<c.length)throw Error("Multiple ids in option overlay: "+
this._options.overlay);b.attr("id",c[0])}-1<a.search(/\.[^#\.\s]+/g)&&(c=a.match(/\.[^#\.\s]+/g).map(function(a){return a.substring(1)}),b.attr("class",c.join(" ")));b.css("display","none");b.append($(document.createElement("div")).append(this._options.spinner));return b};this._appendOverlay=function(){var a=this._options.overlay.split(" ");a.pop();a=a.join(" ");""===a&&(a="body");a=$(a);if(1>a.length)throw Error("No element found to append overlay: "+this._options.overlay);this.$_overlay.appendTo(a)};
this._initializeOverlay=function(){this.$_overlay=$(this._options.overlay);0===this.$_overlay.length&&(!this._options.overlayAuto&&window.console&&console.warn?console.warn("Overlay '"+this._options.overlay+"' for ajax call could not be found!"):(this.$_overlay=this._createOverlay(),this._appendOverlay(this.$_overlay)))};this._showOverlay=function(a,b,c){this.$_overlay.css("display","block").delay(250);void 0!==c&&null!==c&&c(a,b)};this._getAjaxOptions=function(){var a=$.extend({},this._options),
b;for(b in ProkkiAjax.DEFAULTS)a.hasOwnProperty(b)&&delete a[b];var c=function(b){if(!a.hasOwnProperty(b)||void 0===this._options[b])return null;if("function"!==typeof this._options[b]&&window.console&&console.warn)return console.warn("Option "+b+" must be a function, got "+typeof this._options[b]),null;delete a[b];return this._options[b].bind({})}.call(this,"beforeSend");a.beforeSend=function(a,b){this._showOverlay(a,b,c)}.bind(this);return a};this._initializeOptions(d);this._initializeOverlay();
return this};ProkkiAjax.prototype.ajax=function(){return this._xhr=$.ajax(this._getAjaxOptions())};ProkkiAjax.prototype.hideOverlay=function(){if(!1!==this._options.minDuration){var d=new Date-this._startTime;if(d<this._options.minDuration){setTimeout(function(){this.hideOverlay()}.bind(this),this._options.minDuration-d);return}}this.$_overlay.css("display","none")};
ProkkiAjax.DEFAULTS={overlay:"#ajax-loading",overlayAuto:!0,spinner:'<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><span class="sr-only">Refreshing...</span>',minDuration:500,beforeSend:null};(function(d){null==d.prokkiajax&&(d.prokkiajax=function(a){return new ProkkiAjax(a)})})(jQuery);
